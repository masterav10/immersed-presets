plugins {
	id 'javacpp-plugin'
}

version "$decklinkPresetsVersion-$javacppVersion"

sourceSets {	
	testFixtures {
		compileClasspath += sourceSets.javacpp.output
        runtimeClasspath += sourceSets.javacpp.output
	}
}

dependencies {
    api "org.bytedeco:javacpp:$javacppVersion"
    implementation "org.bytedeco:javacpp:$javacppVersion:$javacppPlatform"

	api "org.bytedeco:systems:$javacppPresetVersion"
	api "org.bytedeco:systems:$javacppPresetVersion:$javacppPlatform"
}

task compileIdl(type: Exec) {
	workingDir = "C:/Tools/Blackmagic DeckLink SDK ${decklinkPresetsVersion}/Win/include"

	doFirst {
		commandLine "midl.exe"
		args "-env", "x64"
		args "-h", "DeckLinkAPI_h.h"
		args "-W1" 
		args "-char", "signed"
	    args "-tlb", "DeviceList.tlb"
		args "-target", "NT60" 
		args "-nologo", "DeckLinkAPI.idl"
	}
}

javacppGenerate.dependsOn compileIdl

javacppGenerate {
	systemProperties['decklink.src'] = "${compileIdl.workingDir}"
	
	debug = false
}

javacppJniGenerate {
	debug = false

	doFirst {
		args "-nodelete"
	}
}